# 一、缺陷检测模型训练（YOLOv8n）

结果：

<img src=".\results.png" alt="results" style="zoom: 33%;" />

<img src=".\PR_curve.png" alt="PR_curve" style="zoom: 33%;" />

部分验证集：

原始标签：

<img src=".\val_batch2_labels.jpg" alt="val_batch2_labels" style="zoom: 33%;" />

预测结果：

<img src=".\val_batch2_pred.jpg" alt="val_batch2_pred" style="zoom: 33%;" />

训练结果：因为已有的耐张线夹数据集中凹凸槽欠压缺陷数量较多，因此对此缺陷的检测效果还行，map@0.5达到0.879，其他的钢股断裂缺陷数量较少，仅有两张，信息量太少，训练几乎一定过拟合，没什么效果，因此标注时就未增加此标签。



# 二、缺陷自动检测系统GUI主程序（Qt+Opencv+YOLO+ONNX模型+Mysql+Socket+Serial+GalaxySDK）

<img src=".\image-20260106225307854.png" alt="20260106225307854" style="zoom: 100%;" />
功能：

## 1️⃣ UI 初始化与系统启动管理（整个系统的启动入口与环境准备）

### ✔ 完成的功能

- UI 组件初始化
- 默认日期初始化（起始/截止）
- TableView 模型与列结构初始化
- 显示区域图像自适应缩放
- 加载配置文件（检测编号、日期）
- 初始化数据库连接
- 初始化网络继电器

## 2️⃣ 设备控制与多线程检测框架

### ✔ 完成的功能

- **检测线程（AEDWorker）**
  - 相机采集
  - DR / RGB 图像获取
- **直线度计算线程（StraightnessWorker）**
  - 图像前景提取
  - 曲率、RMS 计算

## 3️⃣ DR 图像缺陷检测（YOLO + ONNX）

### ✔ 功能链路

1. 获取 DR 图像（支持拼接）
2. 加载 ONNX 模型
3. 推理（conf / nms / iou）
4. 缺陷分类统计（目前的缺陷检测模型只能识别**anchor(凹凸槽欠压)与burr(飞边毛刺)**）
5. 判定是否合格（**合格指没有重大缺陷与弯曲度小于2%**）
6. 绘制检测框并显示

## 4️⃣ RGB 图像直线度检测（目标检测 + 几何分析）

### ✔ 功能链路

1. RGB 图像推理定位线夹
2. 提取 ROI
3. 前景提取
4. 计算：
   - RMS 偏差
   - **弯曲度（Curvature）**
5. 根据阈值判定合格性

## 5️⃣ 检测结果综合判定与记录

### ✔ 统一判定逻辑

- DR 有anchor缺陷 → 不合格
- 直线度超限 → 不合格
- 否则 → 合格

### ✔ 自动存储内容(已提前在Mysql中建表)

- 检测结果（合格与不合格）
- 直线度指标
- 图片路径
- 缺陷备注（若检测结果是不合格则在备注说明）
- 检测时间

## 6️⃣ 图像与数据管理

### ✔ 已实现功能

- 自动生成时间戳文件名

- 按日期分类保存图片

<img src=".\image-20260107133511952.png" alt="20260107133511952" style="zoom: 100%;" />

- 检测编号自动递增

- 配置文件保存/恢复编号

<img src=".\image-20260107133554308.png" alt="20260107133554308" style="zoom: 100%;" />


## 7️⃣ 历史记录查询与回放

### ✔ 功能

- 按**日期区间**查询Mysql数据库
- 表格展示历史记录
- 点击“查看”可回放检测图片 + 推理结果
- 支持中文路径

## 8️⃣ 数据导出（CSV）

### ✔ 功能

- 按条件导出：
  - 全部
  - 合格
  - 不合格
- UTF-8 编码 CSV
- 自动统计导出数量

## 9️⃣ 人机交互与系统辅助

### ✔ 包含

- 运行状态日志输出
- 错误信号统一捕获
- 帮助文档 HTML 打开
- 图像自适应缩放显示

## 一次完整检测流程：

**点击“开始检测”**
   **↓**
**启动采集线程**
   **↓**
**获取 DR + RGB 图像**
   **↓**
**DR 图像缺陷检测（YOLO）**
   **↓**
**RGB 图像定位 → 直线度计算（子线程）**
   **↓**
**综合判定合格 / 不合格**
   **↓**
**保存图片 + 写数据库**
   **↓**
**显示结果** 
   **↓**
**结束**

# 三、第四篇论文（已改好）

<img src=".\image-20260107141127916.png" alt="20260107141127916" style="zoom: 100%;" />

# 四、**后续计划：**

1、采用数据增强方法增强数据集中缺陷数据数量，并进一步训练。

2、将各个底层模块（相机，继电器，电机控制，数据库操作等）进一步抽象封装出抽象基类，让高层模块（主程序）不直接依赖于底层模块，而是依赖于抽象层，这样便于后期如果相机，继电器，电机型号改变，不用直接修改或较少的修改高层模块。

3、撰写技术文档，进一步对代码进行测试。

4、联系合适的工程师设计加工电气控制板